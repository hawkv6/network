# This lab is used to test the performance measurement configuration and the data collection via model-driven telemetry with XRd instances.
#
#                                        eth1┌────────────┐eth2
#                                     ┌──────┤  collector ├────────┐
#                                     │      └────────────┘        │
#                                     │                            │
#                                     │G0/0/0/3            G0/0/0/3│
#    ┌────────────┐     G0/0/0/2┌─────┴──────┐      G0/0/0/0┌──────┴─────┐G0/0/0/2    ┌────────────┐
#    │   host-a   ├─────────────┤    xr1     ├──────────────┤     xr2    ├────────────┤   host-b   │
#    └────────────┘eth1         └─────┬──────┘G0/0/0/0      └──────┬─────┘        eth1└────────────┘
#                                     │G0/0/0/1            G0/0/0/1│                        
#                                     │                            │
#                                     │                            │
#                                     │       ┌────────────┐       │
#                                     └───────┤    xr3     ├───────┘
#                                     G0/0/0/0└────────────┘G0/0/0/1



name: test-performance-measurement-xrd

mgmt:
  network: mgt_net
  ipv4-subnet: 172.20.1.0/24

topology:
  nodes:

    xrd1:
      kind: cisco_xrd
      image: ios-xr/xrd-control-plane:7.11.1.48I
      mgmt-ipv4: 172.20.1.11
      startup-config: config/xrd1.cfg

    xrd2:
      kind: cisco_xrd
      image: ios-xr/xrd-control-plane:7.11.1.48I
      mgmt-ipv4: 172.20.1.12
      startup-config: config/xrd2.cfg

    xrd3:
      kind: cisco_xrd
      image: ios-xr/xrd-control-plane:7.11.1.48I
      mgmt-ipv4: 172.20.1.13
      startup-config: config/xrd3.cfg

    collector:
      kind: linux
      image: ghcr.io/insrapperswil/network-ninja:1.0
      mgmt-ipv4: 172.20.1.20
      exec:
        - ip -6 address add 2001:db8:1f::2/64 dev eth1
        - ip -6 address add 2001:db8:2f::2/64 dev eth2

    host-a:
      kind: linux
      image: ghcr.io/insrapperswil/network-ninja:1.0
      mgmt-ipv4: 172.20.1.21
      exec:
        - ip -6 address add 2001:db8:1a::2/64 dev eth1

    host-b:
      kind: linux
      image: ghcr.io/insrapperswil/network-ninja:1.0
      mgmt-ipv4: 172.20.1.22
      exec:
        - ip -6 address add 2001:db8:2b::2/64 dev eth1


  links:
    - endpoints: ["xrd1:Gi0-0-0-0", "xrd2:Gi0-0-0-0"]
    - endpoints: ["xrd1:Gi0-0-0-1", "xrd3:Gi0-0-0-0"]
    - endpoints: ["xrd1:Gi0-0-0-2", "host-a:eth1"]
    - endpoints: ["xrd1:Gi0-0-0-3", "collector:eth1"]
    - endpoints: ["xrd2:Gi0-0-0-1", "xrd3:Gi0-0-0-1"]
    - endpoints: ["xrd2:Gi0-0-0-2", "host-b:eth1"]
    - endpoints: ["xrd2:Gi0-0-0-3", "collector:eth2"]